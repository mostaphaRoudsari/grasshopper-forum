{"body": "\nHi Mostapha,\n\n\u00a0\n\nThanks for looking into this. I think we have stumbled\u00a0onto a bug in the code. See attached images and files.\n\n\u00a0\n\nWith the Sr conversion values all at 1, I get the correct values you have shown. When I then convert those kWh/(m2Sr) output values into kWh by multiplying by the Sr values, I get the correct smooth distribution we expect. Notice how the values gradually get smaller then jump when the patch size changes dramatically. All values are proportional to patch area and Sr values as expected. The values shown below\u00a0should be the same kWh patch values as those output by\u00a0the original cumulativeSky module, only I did the Sr conversion in GH rather than in your python script.\n\n[<img class=\"align-full\" src=\"http://api.ning.com:80/files/lET3ABatHUm2c5ee1bu7owXHgZG7z5Ic7--YwknhQm2I15AcY7im3E2x2A1qITTHpgwUHgxNFeGmiy-UNcC13E6TzH9vbZU2/ValuesfromkWHm2Sroutput.jpg?width=721\" width=\"721\"/>](http://api.ning.com:80/files/lET3ABatHUm2c5ee1bu7owXHgZG7z5Ic7--YwknhQm2I15AcY7im3E2x2A1qITTHpgwUHgxNFeGmiy-UNcC13E6TzH9vbZU2/ValuesfromkWHm2Sroutput.jpg)\n\n\u00a0\n\nYour standard module produces different results. As shown below, the raw kWh output values create strange bands that do not correlate with the patch steradian values. Instead of banding where the patch size changes dramatically, the results vary greatly between similar patch sizes. See below. The output values do not correlate with patch area or steradian values as expected.\n\n[<img class=\"align-full\" src=\"http://api.ning.com:80/files/lET3ABatHUndPuQNXF*fgDPEgf2ZM8UMps1Ki8ErNun0b04MMxnsP*dHUVD4qVWBebkFGFEC5cpSIqQKdrBI*LouGJ344V25/ValuesfromkWHm2output.jpg?width=721\" width=\"721\"/>](http://api.ning.com:80/files/lET3ABatHUndPuQNXF*fgDPEgf2ZM8UMps1Ki8ErNun0b04MMxnsP*dHUVD4qVWBebkFGFEC5cpSIqQKdrBI*LouGJ344V25/ValuesfromkWHm2output.jpg)\n\nThis appears incorrect. I'm not an expert at python (which is why I love the work you have done) but I think the Sr values are being applied to the wrong patches somehow. If all Sr values were 1, this error would not show up, which may explain why your trouble-shooting failed to catch it.\n\n\u00a0\n\nTo test this idea I changed the fifth value of your list from 1.0 to 0.5. As you can see in the image below, this changed the 4th patch row (now very blue), not the 5th. I think this is the issue. Do you agree?\n\n[<img class=\"align-full\" src=\"http://api.ning.com:80/files/lET3ABatHUnYoBUyzAtDZEGrtCyCsdnuxBp*3fJQyirbda-sEPdYJLzOIOpqGoTweHK6j3PVLjNETBYR13gSLw9fAoPws9VH/scripttestfourthpatch.jpg\" width=\"518\"/>](http://api.ning.com:80/files/lET3ABatHUnYoBUyzAtDZEGrtCyCsdnuxBp*3fJQyirbda-sEPdYJLzOIOpqGoTweHK6j3PVLjNETBYR13gSLw9fAoPws9VH/scripttestfourthpatch.jpg)\n\n[<img class=\"align-full\" src=\"http://api.ning.com:80/files/lET3ABatHUnyfLfImgwJV5jm2RNWTEUUisfgdUwx-A5v5oHm*6BIEp1PGM2CPkgaQ2zmVbQctIEL0juUuymUUAYoRZIf9SW3/ValuesfromkWHm2Sroutputadjusted.jpg?width=721\" width=\"721\"/>](http://api.ning.com:80/files/lET3ABatHUnyfLfImgwJV5jm2RNWTEUUisfgdUwx-A5v5oHm*6BIEp1PGM2CPkgaQ2zmVbQctIEL0juUuymUUAYoRZIf9SW3/ValuesfromkWHm2Sroutputadjusted.jpg)\n\nI have attached both scripts for you to review. I used a Detroit epw file.\n", "attachments": [{"link": "http://www.grasshopper3d.com/group/ladybug/forum/attachment/download?id=2985220%3AUploadedFile%3A1203783", "name": "cumulativeSkyMtxerror_removedStr.gh"}, {"link": "http://www.grasshopper3d.com/group/ladybug/forum/attachment/download?id=2985220%3AUploadedFile%3A1203784", "name": "cumulativeSkyMtx error.gh"}, {"link": "http://www.grasshopper3d.com/group/ladybug/forum/attachment/download?id=2985220%3AUploadedFile%3A1203785", "name": "USA_MI_Detroit-City.AP.725375_TMY3.epw"}], "created_by_name": "Leland Curtis", "created_at": "January 13, 2015 at 1:31pm", "created_by": "LelandCurtis", "parent_id": "reply_2985220_Comment_1203099", "id": "reply_2985220_Comment_1203782"}